<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width initial-scale=1">
    <title>小牛仔的blog</title>
    <meta name="description" content="小牛仔的blog">
    <link rel="stylesheet" href=" /css/markdown.css">
    <link rel="stylesheet" href=" /css/main.css">
    <script type="text/javascript" src=" /js/jquery-2.0.3.min.js"></script>
    <link rel="canonical" href="http://young-cowboy.github.io//html/2013/03/22/drag-and-drop.html">
    <link rel="alternate" type="application/atom+xml" title="young cowboy site" href="http://young-cowboy.github.io//feed.xml" />
</head>

    <body>
        <div class="aside-wrap has-trans" id="J_AsideWrap">
            <div class="sidebar">
    <div class="user-avatar">
    </div>
    <ul class="categories-wrap" id="J_CategoryWrap">
        <li class="category J_Category active">全部文章</li>
        <li class="category J_Category" data-category="life">生活</li>
        <li class="category J_Category" data-category="reading">读书</li>
        <li class="category J_Category" data-category="css">CSS/CSS3</li>
        <li class="category J_Category" data-category="html">HTML/HTML5</li>
        <li class="category J_Category" data-category="javascript">JavaScript</li>
        <li class="category J_Category" data-category="git">Git</li>
        <li class="category J_Category" data-category="http">HTTP</li>
        <li class="category J_Category" data-category="node">Node</li>
        <li class="category J_Category" data-category="mongodb">MongoDB</li>
    </ul>
</div>
<span id="J_Arrow" class="icon-arrow"></span>
<div class="post-list" id="J_PostListWrap">
    <ul>
        
        <li data-category="life" class="J_PostLinkWrap">
            <a href="/life/2014/03/20/%E4%B9%B0%E5%9B%BA%E6%80%81%E7%A1%AC%E7%9B%98%E7%9A%84%E6%95%85%E4%BA%8B.html" class="post-link">买固态硬盘的故事<span class="post-date">Mar 20, 2014</span></a>
        </li>
        
        <li data-category="mongodb" class="J_PostLinkWrap">
            <a href="/mongodb/2013/06/08/mongodb%20CRUD.html" class="post-link">MongoDB CRUD<span class="post-date">Jun 8, 2013</span></a>
        </li>
        
        <li data-category="mongodb" class="J_PostLinkWrap">
            <a href="/mongodb/2013/05/24/geting%20start%20with%20mongo.html" class="post-link">Getting Start With Mongodb<span class="post-date">May 24, 2013</span></a>
        </li>
        
        <li data-category="javascript" class="J_PostLinkWrap">
            <a href="/javascript/2013/05/23/http.html" class="post-link">http协议浅学<span class="post-date">May 23, 2013</span></a>
        </li>
        
        <li data-category="css" class="J_PostLinkWrap">
            <a href="/css/2013/04/25/BFC.html" class="post-link">BFC学习<span class="post-date">Apr 25, 2013</span></a>
        </li>
        
        <li data-category="http" class="J_PostLinkWrap">
            <a href="/http/2013/03/30/cookie%E5%AD%A6%E4%B9%A0.html" class="post-link">cookie探索<span class="post-date">Mar 30, 2013</span></a>
        </li>
        
        <li data-category="html" class="J_PostLinkWrap">
            <a href="/html/2013/03/29/html5-filesystem.html" class="post-link">html5 file system<span class="post-date">Mar 29, 2013</span></a>
        </li>
        
        <li data-category="css" class="J_PostLinkWrap">
            <a href="/css/2013/03/29/css%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80.html" class="post-link">CSS 入门基础<span class="post-date">Mar 29, 2013</span></a>
        </li>
        
        <li data-category="html" class="J_PostLinkWrap">
            <a href="/html/2013/03/22/drag-and-drop.html" class="post-link">HTML5 Drag & Drop<span class="post-date">Mar 22, 2013</span></a>
        </li>
        
        <li data-category="node" class="J_PostLinkWrap">
            <a href="/node/2013/03/20/node%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.html" class="post-link">nodejs 入门<span class="post-date">Mar 20, 2013</span></a>
        </li>
        
        <li data-category="javascript" class="J_PostLinkWrap">
            <a href="/javascript/2013/03/20/encoding.html" class="post-link">编码@前端开发<span class="post-date">Mar 20, 2013</span></a>
        </li>
        
        <li data-category="javascript" class="J_PostLinkWrap">
            <a href="/javascript/2013/01/29/history%20of%20js.html" class="post-link">Javascript历史<span class="post-date">Jan 29, 2013</span></a>
        </li>
        
        <li data-category="javascript" class="J_PostLinkWrap">
            <a href="/javascript/2013/01/29/high%20performance%20js.html" class="post-link">Hight Performance JS<span class="post-date">Jan 29, 2013</span></a>
        </li>
        
        <li data-category="javascript" class="J_PostLinkWrap">
            <a href="/javascript/2013/01/01/prototype%20chain.html" class="post-link">javascript 原型链<span class="post-date">Jan 1, 2013</span></a>
        </li>
        
        <li data-category="javascript" class="J_PostLinkWrap">
            <a href="/javascript/2013/01/01/js%20basic.html" class="post-link">javascript 基础学习<span class="post-date">Jan 1, 2013</span></a>
        </li>
        
        <li data-category="html" class="J_PostLinkWrap">
            <a href="/html/2013/01/01/html5%20up&down.html" class="post-link">《html5揭秘》学习笔记<span class="post-date">Jan 1, 2013</span></a>
        </li>
        
        <li data-category="html" class="J_PostLinkWrap">
            <a href="/html/2013/01/01/href.html" class="post-link">html href 浅谈<span class="post-date">Jan 1, 2013</span></a>
        </li>
        
        <li data-category="git" class="J_PostLinkWrap">
            <a href="/git/2013/01/01/git%20remote.html" class="post-link">Git remote<span class="post-date">Jan 1, 2013</span></a>
        </li>
        
        <li data-category="git" class="J_PostLinkWrap">
            <a href="/git/2013/01/01/getting%20start%20with%20git.html" class="post-link">Getting Start With Git<span class="post-date">Jan 1, 2013</span></a>
        </li>
        
        <li data-category="javascript" class="J_PostLinkWrap">
            <a href="/javascript/2013/01/01/execution_context_test.html" class="post-link">javascript 执行环境探索 测试题<span class="post-date">Jan 1, 2013</span></a>
        </li>
        
        <li data-category="javascript" class="J_PostLinkWrap">
            <a href="/javascript/2013/01/01/execution_context.html" class="post-link">javascript 执行环境探索<span class="post-date">Jan 1, 2013</span></a>
        </li>
        
        <li data-category="javascript" class="J_PostLinkWrap">
            <a href="/javascript/2013/01/01/domain.html" class="post-link">domain<span class="post-date">Jan 1, 2013</span></a>
        </li>
        
        <li data-category="git" class="J_PostLinkWrap">
            <a href="/git/2013/01/01/diff&patch.html" class="post-link">diff & patch<span class="post-date">Jan 1, 2013</span></a>
        </li>
        
        <li data-category="css" class="J_PostLinkWrap">
            <a href="/css/2013/01/01/css3-transform-matrix.html" class="post-link">CSS3 transform-matrix<span class="post-date">Jan 1, 2013</span></a>
        </li>
        
    </ul>
</div>
        </div>
        <div class="markdown-ctn-wrap">
            <div class="markdown-ctn">
                <div class="post">

  <header class="post-header">
    <h1 class="post-title">HTML5 Drag & Drop</h1>
    <p class="post-meta">Mar 22, 2013</p>
  </header>

  <article class="post-content">
    <h1 id="drag-and-drop">Drag and Drop</h1>

<p>参考资料</p>

<ul>
  <li><a href="http://www.html5rocks.com/en/tutorials/dnd/basics/">http://www.html5rocks.com/en/tutorials/dnd/basics/</a></li>
</ul>

<h2 id="section">浏览器支持情况</h2>

<p>chrome 7+,safari 5+,firefox 3.6+,ie6 +(ie6+ 不完全支持，无dataTransfet属性)</p>

<h2 id="section-1">事件执行顺序</h2>

<p>dragstart –&gt; drag –&gt; dragenter –&gt; dragover –&gt; dragleave –&gt; drop –&gt; dragend</p>

<h2 id="dom">使DOM对象有拖拽效果</h2>

<p>添加draggable属性，draggable=”true”</p>

<pre><code>&lt;li draggable="true" class=""&gt;A&lt;/li&gt;
</code></pre>

<h2 id="section-2">拖拽事件对象</h2>

<h3 id="edatatransfer">e.dataTransfer</h3>

<p>退拽对象用来传递的媒介</p>

<h3 id="eeffectallowed">e.effectAllowed</h3>

<p>拖拽运行类型值：none，copy，copyLink， copyMove,link,linkMove,move，all，uninitialized</p>

<h3 id="edatatransfersetdataformatdata">e.datatransfer.setData(format,data)</h3>

<p>为元素添加指定数据</p>

<pre><code>e.dataTransfer.setData('text/html', this.innerHTML);
</code></pre>

<h3 id="edatatransfercleardataformat">e.datatransfer.clearData([format])</h3>

<p>删除指定格式的数据，如果未指定，则删除当前元素所有数据</p>

<h4 id="format">format</h4>

<p>设置保存值类型 text/plain, image/jpeg, text/html,text/uri-list</p>

<h3 id="edatatransfertypes-dragstart">e.datatransfer.types dragstart</h3>

<p>事件出发时为元素存储数据的格式,外部文件的拖曳，则返回 files</p>

<h3 id="edatatransfergetdataformat">e.datatransfer.getData(format)</h3>

<p>返回指定数据，如果数据不存在，则返回空字符串</p>

<h3 id="edatatransferfiles">e.datatransfer.files</h3>

<p>如果是拖曳文件，返回文件列表FileList</p>

<h3 id="edatatransfersetdragimageelement-x-y">e.datatransfer.setDragImage(element, x, y)</h3>

<p>制定拖曳元素时跟随鼠标移动的图片，想，y分别为相对鼠标的坐标</p>

<h3 id="edatatransferaddelementelement">e.datatransfer.addElement(element)</h3>

<p>添加一起跟随拖曳的元素</p>

<h3 id="section-3">注意</h3>

<p>Event.preventDefault()</p>

<p>阻止默认的些事件方法等执行。在ondragover中一定要执行preventDefault()，否则ondrop事件不会被触发。
另外，如果是从其他应用软件或是文件中拖东西进来，尤其是图片的时候，默认的动作是显示这个图片或是相关信息，并不是真的执行drop。
此时需要用用document的ondragover事件把它直接干掉。</p>

<h2 id="jquerydatatransfer">让jquery支持dataTransfer</h2>

<p>jquery早期并不支持event的dataTransfer。所以要push到 jQuery.event.props.push(“dataTransfer”);</p>

<h2 id="demo">demo</h2>

<ul>
  <li><a href="/demo/dnd-demo.html">dnd-demo</a></li>
</ul>

<p>部分代码</p>

<pre><code>&lt;ul class="demo-box demo-box3" id="J_BoxCtn"&gt;
    &lt;li draggable="true" class=""&gt;A&lt;/li&gt;
    &lt;li draggable="true" class=""&gt;B&lt;/li&gt;
    &lt;li draggable="true" class=""&gt;C&lt;/li&gt;
&lt;/ul&gt;


jQuery.event.props.push("dataTransfer");
var dnd = {
    "dragstart" : function (e) {
        this.classList.add('draging');
        e.dataTransfer.setData('text/html', this.innerHTML);
        temp = e.target;
    },
    "drag"      : function (e) {
    },
    "dragenter" : function (e) {
        this.classList.add('over');
    },
    "dragover"  : function (e) {
        e.preventDefault();
    },
    "dragleave" : function (e) {
        this.classList.remove('over');
    },
    "drop"      : function (e) {
        e.stopPropagation();
        this.classList.remove('over');
        temp.innerHTML = e.target.innerHTML;
        this.innerHTML = e.dataTransfer.getData('text/html');
    },
    "dragend"   : function (e) {
        this.classList.remove('draging');
        this.classList.remove('over');
    }
};

var temp = null;

for (var i in dnd) {
    $("#J_BoxCtn").on(i, "li", dnd[i]);
}
</code></pre>

  </article>

</div>

            </div>
        </div>
        <footer class="site-footer"></footer>
<script type="text/javascript" src=" /js/main.js"></script>

    </body>
</html>
