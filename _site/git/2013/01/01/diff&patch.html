<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width initial-scale=1">
    <title>小牛仔的blog</title>
    <meta name="description" content="小牛仔的blog">
    <link rel="stylesheet" href=" /css/markdown.css">
    <link rel="stylesheet" href=" /css/main.css">
    <script type="text/javascript" src=" /js/jquery-2.0.3.min.js"></script>
    <link rel="canonical" href="http://young-cowboy.github.io//git/2013/01/01/diff&patch.html">
    <link rel="alternate" type="application/atom+xml" title="young cowboy site" href="http://young-cowboy.github.io//feed.xml" />
</head>

    <body>
        <div class="aside-wrap has-trans" id="J_AsideWrap">
            <div class="sidebar">
    <div class="user-avatar">
    </div>
    <ul class="categories-wrap" id="J_CategoryWrap">
        <li class="category J_Category active">全部文章</li>
        <li class="category J_Category" data-category="life">生活</li>
        <li class="category J_Category" data-category="reading">读书</li>
        <li class="category J_Category" data-category="css">CSS/CSS3</li>
        <li class="category J_Category" data-category="html">HTML/HTML5</li>
        <li class="category J_Category" data-category="javascript">JavaScript</li>
        <li class="category J_Category" data-category="git">Git</li>
        <li class="category J_Category" data-category="http">HTTP</li>
        <li class="category J_Category" data-category="node">Node</li>
        <li class="category J_Category" data-category="mongodb">MongoDB</li>
    </ul>
</div>
<span id="J_Arrow" class="icon-arrow"></span>
<div class="post-list" id="J_PostListWrap">
    <ul>
        
        <li data-category="life" class="J_PostLinkWrap">
            <a href="/life/2014/03/20/%E4%B9%B0%E5%9B%BA%E6%80%81%E7%A1%AC%E7%9B%98%E7%9A%84%E6%95%85%E4%BA%8B.html" class="post-link">买固态硬盘的故事<span class="post-date">Mar 20, 2014</span></a>
        </li>
        
        <li data-category="mongodb" class="J_PostLinkWrap">
            <a href="/mongodb/2013/06/08/mongodb%20CRUD.html" class="post-link">MongoDB CRUD<span class="post-date">Jun 8, 2013</span></a>
        </li>
        
        <li data-category="mongodb" class="J_PostLinkWrap">
            <a href="/mongodb/2013/05/24/geting%20start%20with%20mongo.html" class="post-link">Getting Start With Mongodb<span class="post-date">May 24, 2013</span></a>
        </li>
        
        <li data-category="javascript" class="J_PostLinkWrap">
            <a href="/javascript/2013/05/23/http.html" class="post-link">http协议浅学<span class="post-date">May 23, 2013</span></a>
        </li>
        
        <li data-category="css" class="J_PostLinkWrap">
            <a href="/css/2013/04/25/BFC.html" class="post-link">BFC学习<span class="post-date">Apr 25, 2013</span></a>
        </li>
        
        <li data-category="http" class="J_PostLinkWrap">
            <a href="/http/2013/03/30/cookie%E5%AD%A6%E4%B9%A0.html" class="post-link">cookie探索<span class="post-date">Mar 30, 2013</span></a>
        </li>
        
        <li data-category="html" class="J_PostLinkWrap">
            <a href="/html/2013/03/29/html5-filesystem.html" class="post-link">html5 file system<span class="post-date">Mar 29, 2013</span></a>
        </li>
        
        <li data-category="css" class="J_PostLinkWrap">
            <a href="/css/2013/03/29/css%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80.html" class="post-link">CSS 入门基础<span class="post-date">Mar 29, 2013</span></a>
        </li>
        
        <li data-category="html" class="J_PostLinkWrap">
            <a href="/html/2013/03/22/drag-and-drop.html" class="post-link">HTML5 Drag & Drop<span class="post-date">Mar 22, 2013</span></a>
        </li>
        
        <li data-category="node" class="J_PostLinkWrap">
            <a href="/node/2013/03/20/node%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0.html" class="post-link">nodejs 入门<span class="post-date">Mar 20, 2013</span></a>
        </li>
        
        <li data-category="javascript" class="J_PostLinkWrap">
            <a href="/javascript/2013/03/20/encoding.html" class="post-link">编码@前端开发<span class="post-date">Mar 20, 2013</span></a>
        </li>
        
        <li data-category="javascript" class="J_PostLinkWrap">
            <a href="/javascript/2013/01/29/history%20of%20js.html" class="post-link">Javascript历史<span class="post-date">Jan 29, 2013</span></a>
        </li>
        
        <li data-category="javascript" class="J_PostLinkWrap">
            <a href="/javascript/2013/01/29/high%20performance%20js.html" class="post-link">Hight Performance JS<span class="post-date">Jan 29, 2013</span></a>
        </li>
        
        <li data-category="javascript" class="J_PostLinkWrap">
            <a href="/javascript/2013/01/01/prototype%20chain.html" class="post-link">javascript 原型链<span class="post-date">Jan 1, 2013</span></a>
        </li>
        
        <li data-category="javascript" class="J_PostLinkWrap">
            <a href="/javascript/2013/01/01/js%20basic.html" class="post-link">javascript 基础学习<span class="post-date">Jan 1, 2013</span></a>
        </li>
        
        <li data-category="html" class="J_PostLinkWrap">
            <a href="/html/2013/01/01/html5%20up&down.html" class="post-link">《html5揭秘》学习笔记<span class="post-date">Jan 1, 2013</span></a>
        </li>
        
        <li data-category="html" class="J_PostLinkWrap">
            <a href="/html/2013/01/01/href.html" class="post-link">html href 浅谈<span class="post-date">Jan 1, 2013</span></a>
        </li>
        
        <li data-category="git" class="J_PostLinkWrap">
            <a href="/git/2013/01/01/git%20remote.html" class="post-link">Git remote<span class="post-date">Jan 1, 2013</span></a>
        </li>
        
        <li data-category="git" class="J_PostLinkWrap">
            <a href="/git/2013/01/01/getting%20start%20with%20git.html" class="post-link">Getting Start With Git<span class="post-date">Jan 1, 2013</span></a>
        </li>
        
        <li data-category="javascript" class="J_PostLinkWrap">
            <a href="/javascript/2013/01/01/execution_context_test.html" class="post-link">javascript 执行环境探索 测试题<span class="post-date">Jan 1, 2013</span></a>
        </li>
        
        <li data-category="javascript" class="J_PostLinkWrap">
            <a href="/javascript/2013/01/01/execution_context.html" class="post-link">javascript 执行环境探索<span class="post-date">Jan 1, 2013</span></a>
        </li>
        
        <li data-category="javascript" class="J_PostLinkWrap">
            <a href="/javascript/2013/01/01/domain.html" class="post-link">domain<span class="post-date">Jan 1, 2013</span></a>
        </li>
        
        <li data-category="git" class="J_PostLinkWrap">
            <a href="/git/2013/01/01/diff&patch.html" class="post-link">diff & patch<span class="post-date">Jan 1, 2013</span></a>
        </li>
        
        <li data-category="css" class="J_PostLinkWrap">
            <a href="/css/2013/01/01/css3-transform-matrix.html" class="post-link">CSS3 transform-matrix<span class="post-date">Jan 1, 2013</span></a>
        </li>
        
    </ul>
</div>
        </div>
        <div class="post">
    <header class="post-header">
        <h1 class="post-title" style="font-size: 34px;">diff & patch</h1>
        <p class="post-meta">Jan 1, 2013</p>
    </header>
    <div class="markdown-ctn-wrap">
        <div class="markdown-ctn">
            <h1 id="diffpatch">diff&amp;patch</h1>

<p>在没有cvs的时代它们一直是很好的源码比较和打打补丁工具。</p>

<h2 id="diff">1 diff</h2>
<p>用<strong>逐行比较两个文本文件</strong>，列出其不同之处。</p>

<h3 id="section">1.1 语法造成结构以及选项</h3>

<p>语法：diff [选项] file1 file2</p>

<p>常用选项：</p>

<ul>
  <li>-r 是一个递归选项，设置了这个选项，diff会将两个不同版本源代码目录中的所有对应文件全部都进行一次比较，包括子目录文件。</li>
  <li>-w 忽略所有空格</li>
  <li>-b 忽略由于空格属不同造成的差异</li>
  <li>-B 忽略任何因空行而造成的差异。</li>
  <li>-c 上下文模式输出diff</li>
  <li>-u 合并模式输出diff</li>
  <li>……</li>
</ul>

<h3 id="diff-1">1.2 diff输出模式的历史</h3>

<p>要想理解现代的diff，看下diff历史是很有必要的。</p>

<ul>
  <li>正常模式（normal diff）</li>
  <li>上下文格式（context diff）</li>
  <li>合并格式（unified diff）</li>
</ul>

<p>这里我准备了2个文本a.txt，b.txt</p>

<p>a.txt</p>

<pre><code>window.onscroll = function () {
    var top = document.documentElement.scrollTop || document.body.scrollTop;
    if (top &gt; 586 &amp;&amp; !hasFixed) {
        hasFixed = true;
        if (isIE6) {
            nav.style.top = top + 586 + "px";
            return;
        }
        nav.className += ' mobile-download-fixed';
        return;
    }
    if (top &lt; 586) {
        hasFixed = false;
        nav.className = 'mobile-download';
    }
}
</code></pre>

<p>b.txt</p>

<pre><code>window.onscroll = function () {		
    var top = document.documentElement.scrollTop || document.body.scrollTop;
    if (top &gt; 586 &amp;&amp; !hasFixed) {
        hasFixed = false;
        nav.className += ' mobile-download-fixed';
        return;
    }
    if (top &lt; 586) {
        hasFixed = false;
        nav.className = 'mobile-download';
    }
}
alert('hello world');
</code></pre>

<p>可以看出我相对于a文件对b文件作了增，删，改操作；</p>

<p>正常模式的diff输出结果很简单，但是结果过于简单很难理解。</p>

<pre><code>$ diff a.txt b.txt
1c1
&lt; window.onscroll = function () {
---
&gt; window.onscroll = function () {
4,8c4
&lt;         hasFixed = true;
&lt;         if (isIE6) {
&lt;             nav.style.top = top + 586 + "px";
&lt;             return;
&lt;         }
---
&gt;         hasFixed = false;
12c8,9
&lt;     if (top &lt; 586) {
---
&gt;
&gt;     if (top &lt; 586)      {
16c13,14
&lt; }
\ 文件尾没有 newline 字符
---
&gt; }
&gt; alert('hello world');
\ 文件尾没有 newline 字符
</code></pre>

<p>所以诞生了context diff，让输出结果有上下文，这样好了解。</p>

<pre><code>$ diff -c a.txt b.txt
*** a.txt       2012-09-12 17:35:11.952861200 +0800
--- b.txt       2012-09-12 17:54:13.569823400 +0800
***************
*** 1,16 ****
! window.onscroll = function () {
      var top = document.documentElement.scrollTop || document.body.scrollTop;
      if (top &gt; 586 &amp;&amp; !hasFixed) {
!         hasFixed = true;
!         if (isIE6) {
!             nav.style.top = top + 586 + "px";
!             return;
!         }
          nav.className += ' mobile-download-fixed';
          return;
      }
!     if (top &lt; 586) {
          hasFixed = false;
          nav.className = 'mobile-download';
      }
! }
\ 文件尾没有 newline 字符
--- 1,14 ----
! window.onscroll = function () {
      var top = document.documentElement.scrollTop || document.body.scrollTop;
      if (top &gt; 586 &amp;&amp; !hasFixed) {
!         hasFixed = false;
          nav.className += ' mobile-download-fixed';
          return;
      }
!
!     if (top &lt; 586)      {
          hasFixed = false;
          nav.className = 'mobile-download';
      }
! }
! alert('hello world');
\ 文件尾没有 newline 字符
</code></pre>

<p>但是context diff输出浪费空间，所以之后诞生了合并模式,在一个输出里表明diff。</p>

<pre><code>$ diff -u a.txt b.txt
--- a.txt       2012-09-12 17:35:11.952861200 +0800
+++ b.txt       2012-09-12 17:54:13.569823400 +0800
@@ -1,16 +1,14 @@
-window.onscroll = function () {
+window.onscroll = function () {
     var top = document.documentElement.scrollTop || document.body.scrollTop;
     if (top &gt; 586 &amp;&amp; !hasFixed) {
-        hasFixed = true;
-        if (isIE6) {
-            nav.style.top = top + 586 + "px";
-            return;
-        }
+        hasFixed = false;
         nav.className += ' mobile-download-fixed';
         return;
     }
-    if (top &lt; 586) {
+
+    if (top &lt; 586)      {
         hasFixed = false;
         nav.className = 'mobile-download';
     }
-}
\ 文件尾没有 newline 字符
+}
+alert('hello world');
\ 文件尾没有 newline 字符
</code></pre>

<p>合并模式可以让人对diff一目了然。</p>

<h3 id="demo">1.3 demo演示</h3>

<p>现在使用diff命令做一个最简单的合并模式diff输出</p>

<pre><code>diff -u a.txt b.txt
</code></pre>

<p>使用统一格式输出差异，并且忽略空格。</p>

<pre><code>--- a.txt       2012-09-12 17:35:11.952861200 +0800
+++ b.txt       2012-09-12 17:36:03.454861200 +0800
@@ -1,11 +1,7 @@
-window.onscroll = function () {
+window.onscroll = function () {
     var top = document.documentElement.scrollTop || document.body.scrollTop;
     if (top &gt; 586 &amp;&amp; !hasFixed) {
-        hasFixed = true;
-        if (isIE6) {
-            nav.style.top = top + 586 + "px";
-            return;
-        }
+        hasFixed = false;
         nav.className += ' mobile-download-fixed';
         return;
     }
@@ -13,4 +9,5 @@
         hasFixed = false;
         nav.className = 'mobile-download';
     }
-}
\ 文件尾没有 newline 字符
+}
+alert('hello world');
\ 文件尾没有 newline 字符
</code></pre>

<h4 id="section-1">1.3.1 解释</h4>

<p>第一，二行的—表示源文件，+++表示目标文件</p>

<p>每个@@**@@表示一个差异的开始，其中的内容-1,11 +1,7表示原始文件的第一行，连续11行和目标文件第一行连续7行有差异（包括没有差异）。</p>

<p>-:表示原始文件的行数</p>

<p>+:表示目标文件的行数。</p>

<p>以此类推.</p>

<h2 id="patch">2 patch</h2>

<p>patch命令相当于diff操作的逆过程，利用产生的diff来修复文件。</p>

<h3 id="demo-1">2.1 简单的用法demo</h3>

<pre><code>$ diff -u a.txt b.txt &gt; temp

$ cat temp
--- a.txt       2012-09-12 17:35:11.952861200 +0800
+++ b.txt       2012-09-12 19:04:33.373155300 +0800
@@ -1,16 +1,14 @@
 window.onscroll = function () {
     var top = document.documentElement.scrollTop || document.body.scrollTop;
     if (top &gt; 586 &amp;&amp; !hasFixed) {
-        hasFixed = true;
-        if (isIE6) {
-            nav.style.top = top + 586 + "px";
-            return;
-        }
+        hasFixed = false;
         nav.className += ' mobile-download-fixed';
         return;
     }
-    if (top &lt; 586) {
+
+    if (top &lt; 586)      {
         hasFixed = false;
         nav.className = 'mobile-download';
     }
-}
\ 文件尾没有 newline 字符
+}
+alert('hello world');
\ 文件尾没有 newline 字符
</code></pre>

<p>这样我们就可以利用temp文件操作a.txt更新为b.txt或者将b.txt还原为a.txt</p>

<pre><code>$ patch a.txt &lt; temp
patching file a.txt
Hunk #1 succeeded at 1 with fuzz 2.

$ patch -R b.txt &lt; temp
</code></pre>


            <p>(完)</p>
        </div>
    </div>
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="请将此处替换成文章在你的站点中的ID" data-title="diff & patch" id="J_DSWrap"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
        $("#J_DSWrap").attr("data-url", location.protocol + "//" + location.host + location.pathname);
        $("#J_DSWrap").attr("data-thread-key", location.pathname);
        var duoshuoQuery = {short_name : "young-cowboy"};
        (function () {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';
            ds.async = true;
            ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0]
                    || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
    </script>
    <!-- 多说公共JS代码 end -->
</div>

        <footer class="site-footer"></footer>
<script type="text/javascript" src=" /js/main.js"></script>

    </body>
</html>
